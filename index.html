<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fractured Engine</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Intro overlay (first time only) -->
  <div id="introOverlay" class="hidden">
    <div id="introModal">
      <div id="introTitle">Fractured Engine</div>
      <div id="introBody">
        The core that once held reality together has shattered.
        Its routines are gone, leaving only drifting Sparks in the dark.
        You are the new Architect, rebuilding from nothing by stitching together
        crude constructs until the engine remembers how to run itself.
      </div>
      <div id="introHint">
        Your work begins with simple generators.
        As the engine strengthens, deeper systems will reveal themselves.
      </div>
      <button id="introConfirmBtn">Begin reassembly</button>
    </div>
  </div>

  <!-- Resource bar -->
  <div id="resourceBar">
    <div class="res-item">
      <span class="res-icon">●</span>
      <span class="res-value inline-stat" id="sparksDisplay">0</span>
      <span class="res-label">Sparks</span>
    </div>
    <div class="res-item">
      <span class="res-icon">⌘</span>
      <span class="res-value inline-stat" id="stabilizersDisplay">0</span>
      <span class="res-label">Stabilizers</span>
    </div>
    <div class="res-item">
      <span class="res-icon">✶</span>
      <span class="res-value inline-stat" id="spsDisplay">0</span>
      <span class="res-label">Sparks per second</span>
    </div>
  </div>

  <!-- Main content -->
  <div id="gameRoot">
    <div id="gameInner">
      <div>
        <h1>Fractured Engine</h1>
        <div id="subtitle">Prototype build - let the engine run itself</div>
      </div>

      <!-- Sparks tab content -->
      <div id="tabSparks">
        <div id="sparksLayout">
          <!-- Generators panel -->
          <div class="panel" id="panelGenerators">
            <div class="panel-title">
              <span><span class="icon">◆</span> Sparks Lattice</span>
            </div>
            <div class="panel-flavor">
              The first layer of the new engine. Simple constructs that coax Sparks into motion.
            </div>
            <div class="row small">
              Generators produce Sparks automatically. Higher constructs unlock as the lattice grows.
            </div>

            <div class="row small">
              Buy amount:
              <button data-buy-mode="1">x1</button>
              <button data-buy-mode="10">x10</button>
              <button data-buy-mode="max">Max</button>
            </div>
            
            <div id="generatorsList"></div>
          </div>

          <!-- Stabilize panel (prestige) -->
          <div class="panel hidden" id="panelStabilize">
            <div class="panel-title">
              <span><span class="icon">⌘</span> Stabilization Cycle</span>
            </div>
            <div class="panel-flavor">
              Collapse this run into a cleaner pattern and store what the engine learned as Stabilizers.
            </div>
            <div class="row small">
              Resets Sparks, generators, and Spark-layer upgrades. Stabilizer upgrades persist.
            </div>
            <div class="row small">
              Raw progress toward next Stabilizer:
              <span id="stabilizeProgress" class="inline-stat">0.00</span>
            </div>
            <div class="row small">
              Actual yield on stabilize:
              <span id="stabilizePreview" class="inline-stat">0</span> Stabilizers
              (run total <span id="runTotalSparks" class="inline-stat">0</span> Sparks)
            </div>
            <button id="stabilizeBtn">Stabilize Flow</button>
          </div>
        </div>
      </div>

      <!-- Upgrades tab content -->
      <div id="tabUpgrades" class="hidden">
        <div class="panel" id="panelUpgrades">
          <div class="panel-title">
            <span><span class="icon">✦</span> Engine Upgrades</span>
          </div>
          <div class="panel-flavor">
            Small adjustments in the lattice shift how every construct behaves.
            Upgrades here set the tone for the entire run.
          </div>

          <!-- Spark upgrades -->
          <div class="upgrade-section">
            <div class="upgrade-section-title">Spark Upgrades</div>
            <div class="row small">
              Purchased Spark upgrades are lost when you stabilize, unless you unlock persistence.
            </div>
            <div class="upgrade-grid" id="sparkUpgradesGrid"></div>
          </div>

          <!-- Stabilizer upgrades -->
          <div class="upgrade-section">
            <div class="upgrade-section-title">Stabilizer Upgrades</div>
            <div class="row small">
              Stabilizer upgrades persist through stabilizations.
            </div>
            <div class="upgrade-grid" id="stabUpgradesGrid"></div>
          </div>

          <!-- Details for hovered/selected upgrade -->
          <div id="upgradeDetails">
            <div id="upgradeDetailsTitle">Hover or tap an upgrade icon.</div>
            <div id="upgradeDetailsFlavor"></div>
            <div id="upgradeDetailsEffect"></div>
            <div id="upgradeDetailsCost"></div>
            <div id="upgradeDetailsCurrent"></div>
          </div>
        </div>
      </div>

      <!-- Settings tab content -->
      <div id="tabSettings" class="hidden">
        <div class="panel" id="panelSettings">
          <div class="panel-title">
            <span><span class="icon">☰</span> Settings</span>
          </div>
          <div class="panel-flavor small">
            Adjust how the engine presents itself. Changes are stored in your local save.
          </div>

          <div class="settings-row">
            <label>
              <input type="checkbox" id="setting_autosave">
              Enable autosave (periodically saves in the background)
            </label>
          </div>

          <div class="settings-row">
            <span class="small">Number notation:</span><br>
            <select id="notationSelect">
              <option value="short">Short (1.23K)</option>
              <option value="scientific">Scientific (1.23e3)</option>
            </select>
          </div>

          <div class="settings-buttons">
            <button id="btnSaveNow">Save now</button>
            <button id="btnShowIntro">Show intro again next load</button>
            <button id="btnFullReset">Reset all progress</button>
          </div>
        </div>
      </div>

      <!-- Nav bar -->
      <div id="navBar">
        <button class="nav-btn active" data-tab="sparks">Sparks</button>
        <button class="nav-btn" data-tab="upgrades">Upgrades</button>
        <button class="nav-btn" data-tab="settings">Settings</button>
      </div>
    </div>
  </div>

  <script src="game.js"></script>
</body>
</html>
